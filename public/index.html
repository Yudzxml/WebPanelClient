<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>RESELLER PANEL BY YUDZXML</title>
  <style>
    /* ===== Body & Typography ===== */
body {
  background: #0a0a0f;
  color: #d6f6ff;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  padding: 24px 16px;
  margin: 0;
  min-height: 100vh;
}
* { box-sizing: border-box; }

h1 {
  text-align: center;
  font-size: 2.4rem;
  color: #00ccff;
  text-shadow: 0 0 14px #00ccffaa;
  margin-bottom: 32px;
  font-weight: 700;
}

h3 {
  color: #00ccff;
  border-bottom: 2px solid #00ccff55;
  padding-bottom: 8px;
  margin-top: 28px;
  margin-bottom: 20px;
  font-weight: 600;
  letter-spacing: 0.04em;
  font-size: 1.2rem;
}

/* ===== Inputs & Selects ===== */
input, select {
  width: 100%; max-width: 320px;
  padding: 12px 16px;
  margin: 10px 0 20px;
  border-radius: 10px;
  border: none;
  background: #111827;
  color: #d6f6ff;
  font-size: 1rem;
  box-shadow: inset 0 0 8px #00ccff44;
  transition: box-shadow 0.25s ease, outline-color 0.25s ease;
  outline-offset: 2px;
  outline-color: transparent;
}
input:focus, select:focus {
  outline-color: #00ccffcc;
  box-shadow: inset 0 0 10px #00ccffbb;
}

/* ===== Buttons ===== */
button {
  cursor: pointer;
  user-select: none;
}
.primary-btn {
  width: 100%; max-width: 320px;
  padding: 12px 0;
  margin-top: 12px;
  font-size: 1.1rem;
  font-weight: 700;
  color: #000;
  background: #00ccff;
  border: none;
  border-radius: 10px;
  box-shadow: 0 0 16px #00ccffcc;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
  text-align: center;
}
.primary-btn:hover:not(:disabled) {
  background: #009fcc;
  box-shadow: 0 0 24px #00e0ff;
  transform: translateY(-2px);
}
.primary-btn:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 0 16px #00ccffcc;
}
.primary-btn:disabled {
  background: #444; color: #999; cursor: not-allowed; box-shadow: none;
}

/* ===== Copy Buttons ===== */
.copy-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  color: #00ccff;
  padding: 4px 8px;
  border-radius: 6px;
  transition: background-color 0.2s ease;
}
.copy-btn:hover { 
  text-decoration: underline; 
  background-color: #003f55;
}

.toggle-pass-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #00ffe5;
  margin-left: 5px;
}

/* ===== Boxes ===== */
#loginBox, #mainBox {
  max-width: 340px;
  margin: 0 auto 28px;
  padding: 16px;
  background: rgba(255,255,255,0.02);
  border-radius: 14px;
  box-shadow: 0 0 12px #00ccff33;
}

/* ===== Panels ===== */
#panels {
  margin-top: 24px;
  max-width: 780px;
  margin-left: auto; margin-right: auto;
  display: flex; flex-wrap: wrap;
  gap: 20px; justify-content: center;
}

.panel-box {
  background: rgba(0,0,25,0.65);
  border: 1.6px solid #00ccff66;
  border-radius: 16px;
  padding: 18px 20px;
  width: 280px;
  box-shadow: 0 0 16px #00ccff99;
  backdrop-filter: blur(10px);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.panel-box:hover {
  transform: scale(1.04);
  box-shadow: 0 0 26px #00e0ffee;
}

.panel-info {
  margin-bottom: 10px;
  font-size: 0.95rem;
  line-height: 1.4;
  word-break: break-word;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.panel-info b { 
  display: inline-block; 
  width: 100px; 
  color: #00ccff; 
  font-weight: 700; 
}

.panel-actions {
  margin-top: 16px;
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}

/* ===== Tombol Delete ===== */
.panel-actions .delete-btn {
  flex: 1;
  padding: 8px 14px;
  font-size: 0.9rem;
  border-radius: 10px;
  background: #ff3366;
  color: white;
  box-shadow: 0 0 12px #ff3366cc;
  border: none;
  font-weight: 600;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
}
.panel-actions .delete-btn:hover {
  background: #cc204f;
  box-shadow: 0 0 20px #ff5577ff;
  transform: translateY(-2px);
}
.panel-actions .delete-btn:active {
  transform: translateY(0);
  box-shadow: 0 0 12px #ff3366cc;
}

/* ===== Tombol Copy ===== */
.panel-actions .copy-btn {
  flex: 1;
  padding: 8px 14px;
  font-size: 0.9rem;
  border-radius: 10px;
  background: #0077cc;
  color: white;
  box-shadow: 0 0 12px #0077cccc;
  border: none;
  font-weight: 600;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
}
.panel-actions .copy-btn:hover {
  background: #005fa3;
  box-shadow: 0 0 20px #3399ffcc;
  transform: translateY(-2px);
}
.panel-actions .copy-btn:active {
  transform: translateY(0);
  box-shadow: 0 0 12px #0077cccc;
}

@media (max-width: 768px) {
  .panel-box { width: 90vw; padding: 22px 26px; }
}
  </style>
</head>
<body>
  <h1>RESELLER PANEL</h1>

  <div id="loginBox">
    <h3>LOGIN ACCOUNT</h3>
    <input type="text" id="username" placeholder="Your email (e.g. yudzxml@gmail.com)" autocomplete="username" />
    <input type="password" id="password" placeholder="Your password" autocomplete="current-password" />
    <button id="loginBtn" class="primary-btn" onclick="login()">LOGIN</button>
  </div>

  <div id="mainBox" style="display:none">
    <h3>CREATE PANEL</h3>
    <input type="text" id="cuser" placeholder="Panel Username" />
    <input type="password" id="cpass" placeholder="Panel Password" />
    <select id="ram" aria-label="Select RAM size">
      <option value="1gb">RAM 1 GB ( BY YUDZXML )</option>
      <option value="2gb">RAM 2 GB ( BY YUDZXML )</option>
      <option value="3gb">RAM 3 GB ( BY YUDZXML )</option>
      <option value="4gb">RAM 4 GB ( BY YUDZXML )</option>
      <option value="5gb">RAM 5 GB ( BY YUDZXML )</option>
      <option value="6gb">RAM 6 GB ( BY YUDZXML )</option>
      <option value="7gb">RAM 7 GB ( BY YUDZXML )</option>
      <option value="8gb">RAM 8 GB ( BY YUDZXML )</option>
      <option value="9gb">RAM 9 GB ( BY YUDZXML )</option>
      <option value="10gb">RAM 10 GB ( BY YUDZXML )</option>
      <option value="unli">RAM UNLIMITED ( BY YUDZXML )</option>
      <!-- other options -->
    </select>
    <button id="createBtn" class="primary-btn" onclick="createPanel()">CREATE PANEL</button>

    <h3>PANEL DETAIL</h3>
    <div id="panels"><i>Memuat Panels...</i></div>
  </div>

  <script>
    const API_URL = '/api';

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text)
        .then(() => alert('Copied to clipboard!'))
        .catch(() => alert('Copy failed'));
    }

    function setCookie(name, value, days) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/; SameSite=Lax`;
    }

    function getCookie(name) {
      const cookies = document.cookie ? document.cookie.split('; ') : [];
      for (const c of cookies) {
        const [key, ...v] = c.split('=');
        if (key === name) return decodeURIComponent(v.join('='));
      }
      return '';
    }

    function getUserFromCookie() {
      try {
        const str = getCookie('user');
        if (!str) return null;
        const u = JSON.parse(str);
        if (u.username && u.password) return u;
      } catch (e) {}
      return null;
    }

    async function login() {
      const btn = document.getElementById('loginBtn'); btn.disabled = true;
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if (!u || !p) { alert('Fill in both fields.'); btn.disabled = false; return; }
      try {
        const res = await fetch(API_URL + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({username:u,password:p}) });
        const data = await res.json(); if (!res.ok) throw new Error(data.message||'Login failed');
        setCookie('user', JSON.stringify({username:u,password:p}), 7);
        document.getElementById('loginBox').style.display='none';
        document.getElementById('mainBox').style.display='block';
        loadPanels();
      } catch (e) { alert(e.message); } finally { btn.disabled=false; }
    }

    async function loadPanels() {
      const user = getUserFromCookie(); if (!user) return alert('Please login');
      const container = document.getElementById('panels'); container.innerHTML='<i>Loading panels...</i>';
      try {
        const res = await fetch(API_URL + '/panels', { credentials:'include' }); if (!res.ok) throw new Error('Failed to load panels');
        const panels = await res.json(); renderPanels(panels);
      } catch (e) {
        container.innerHTML=`<i style="color:#ff6666;">${e.message}</i>`;
      }
    }

    function renderPanels(panels) {
  const container = document.getElementById('panels');
  container.innerHTML = '';

  if (!Array.isArray(panels) || panels.length === 0) {
    container.innerHTML = '<i style="color:#888">Create Panel Terlebih Dahulu</i>';
    return;
  }

  panels.forEach(panel => {
    const loginUrl = panel.loginUrl || 'https://private-server.yudzxsnayders.x-vvip.cloud/';
    const encoded = encodeURIComponent(JSON.stringify(panel));

    const div = document.createElement('div');
    div.className = 'panel-box';

    div.innerHTML = `
      ${renderInfo("Server ID", panel.serverId)}
      ${renderInfo("User ID", panel.userId)}
      ${renderInfo("Login URL", loginUrl)}
      ${renderInfo("Username", panel.username)}
      ${renderInfo("Password", panel.password)}
      ${renderInfo("RAM", panel.ram)}
      ${renderInfo("Created", panel.createdAt ? new Date(panel.createdAt).toLocaleString() : 'N/A')}

      <div class="panel-actions">
        <button class="copy-btn" onclick="copyToClipboard('${loginUrl}')">Copy URL</button>
        <button class="copy-btn" onclick="copyToClipboard('${panel.username || ''}')">Copy Username</button>
        <button class="copy-btn" onclick="copyToClipboard('${panel.password || ''}')">Copy Password</button>
        <button class="delete-btn" onclick="deletePanel(decodeURIComponent('${encoded}'))">Delete</button>
      </div>
    `;

    container.appendChild(div);
  });
}

function renderInfo(label, value) {
  return `
    <div class="panel-info">
      <b>${label}:</b>
      <span class="password-hidden" data-password="${value || 'N/A'}">****</span>
      <button class="toggle-pass-btn" onclick="togglePasswordVisibility(this)">
        <i class="fas fa-eye"></i>
      </button>
    </div>
  `;
}

function copyToClipboard(text) {  
  navigator.clipboard.writeText(text).then(() => {  
    alert('Copied: ' + text);  
  }).catch(() => {  
    alert('Failed to copy text.');  
  });  
}

function togglePasswordVisibility(button) {
  const span = button.previousElementSibling;
  const realValue = span.getAttribute('data-password');
  const icon = button.querySelector('i');

  if (span.textContent === '****') {
    span.textContent = realValue;
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    span.textContent = '****';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

    async function createPanel() {
      const btn = document.getElementById('createBtn'); btn.disabled=true;
      const user = getUserFromCookie(); if (!user) { alert('Please login'); btn.disabled=false; return; }
      const cu = document.getElementById('cuser').value.trim();
      const cp = document.getElementById('cpass').value.trim();
      const ram = document.getElementById('ram').value;
      if (!cu || !cp) { alert('Fill panel credentials'); btn.disabled=false; return; }
      try {
        const res = await fetch(API_URL+'/create-panel',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({github:{username:user.username,password:user.password},panelData:{username:cu,password:cp,ram:ram}})});
        const data=await res.json(); if(!res.ok) throw new Error(data.message||'Create failed');
        alert('Panel created!');
        document.getElementById('cuser').value='';
        document.getElementById('cpass').value='';
        loadPanels();
      } catch(e){alert(e.message);} finally{btn.disabled=false;}
    }

    async function deletePanel(enc) {
      const user = getUserFromCookie(); if (!user) return alert('Please login');
      if (!confirm('Are you sure?')) return;
      try {
        const p = JSON.parse(decodeURIComponent(enc));
        if (!p.serverId||!p.userId) return alert('Missing IDs');
        const res = await fetch(API_URL+'/delete-panel',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({username:user.username,password:user.password,serverId:p.serverId,userId:p.userId})});
        const data=await res.json(); if(!res.ok) throw new Error(data.message||'Delete failed');
        alert('Panel deleted!'); loadPanels();
      } catch(e){alert(e.message);}    }

    window.onload = () => { if(getUserFromCookie()){document.getElementById('loginBox').style.display='none';document.getElementById('mainBox').style.display='block'; loadPanels();}};
  </script>
</body>
</html>